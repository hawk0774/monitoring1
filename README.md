# 13. Системы мониторинга

## Задание 1

Перечислите основные метрики, которые стоит мониторить для оценки состояния приложения и инфраструктуры.

### Мониторинг работоспособности ПО
- Общее количество **HTTP/HTTPS-запросов** к приложению  
- Количество неудачных ответов (коды **4xx** и **5xx**, особенно 400, 404, 500, 503)  
- Доступность приложения из разных георегионов (при необходимости)

### Мониторинг оборудования

| Компонент   | Ключевые метрики                                                                 |
|-------------|-----------------------------------------------------------------------------------|
| **CPU**     | • Общая загрузка процессора<br>• Загрузка CPU от процесса приложения             |
| **RAM**     | • Занятая и свободная память<br>• Динамика потребления                           |
| **HDD/SSD** | • Нагрузка на диск (IOPS, latency)<br>• Остаточная ёмкость<br>• SMART-статус<br>• График заполняемости |
| **Сеть**    | • Объём входящего/исходящего трафика<br>• Ошибки на интерфейсах                  |

### Бизнес-мониторинг (на примере системы формирования отчётов)
- Количество успешно сформированных отчётов  
- Количество неудачных попыток формирования отчётов  
- Количество отчётов в обработке  
- Среднее / 95-й перцентиль времени формирования одного отчёта  

### Мониторинг безопасности
- Аномально высокое количество попыток авторизации  
- Сроки действия SSL/TLS-сертификатов  
- Аномальное количество запросов на отчёты от одного пользователя  
- Трафик из нехарактерных георегионов (если приложение используется только в одной стране)

## Задание 2

Менеджер продукта жалуется, что не понимает **RAM**, **inodes**, **CPU LA** и хочет видеть, насколько команда выполняет обязательства перед клиентами.

**Решение**

1. Кратко объяснить термины (один раз):
   - **RAM** — сколько оперативной памяти занято и сколько осталось свободно  
   - **inodes** — «ярлыки» на файлы; когда заканчиваются — нельзя создавать новые файлы даже при свободном месте  
   - **CPU Load Average** — средняя загруженность процессора за 1/5/15 минут  

2. Перевести всё в бизнес-термины через **SLA → SLO → SLI**:
   - Утвердить **SLA** с клиентом (например, доступность 99.9 %, время отчёта ≤ 30 сек в 95 % случаев)  
   - Определить внутренние **SLO** (чуть строже клиентских)  
   - Показывать только отклонения **SLI** от **SLO** в виде цветовых индикаторов  

   → Менеджеру больше не нужно разбираться в технике — он видит только «всё в рамках обязательств» или «есть риск нарушения SLA».

## Задание 3

Бюджет на централизованную систему логов не выделили, но разработчикам нужны ошибки приложений.

**Бюджетные варианты**

| Нагрузка / масштаб      | Решение                                      | Плюсы                     | Минусы                     |
|-------------------------|----------------------------------------------|---------------------------|----------------------------|
| Маленький проект        | grep-скрипты + Slack/Email по ключевым словам | Бесплатно, быстро         | Нет истории и поиска       |
| Средний проект          | **Sentry** (бесплатный лимит 5k событий/мес) или **GlitchTip** | Удобный UI, дедупликация  | При превышении лимита — платно |
| Есть свои сервера       | **Loki + Grafana** или **Graylog CE**        | Бесплатно, масштабируемо  | Нужно администрировать     |
| Уже есть ELK/Zabbix     | Настроить отправку логов в существующий стек | Не требует новых ресурсов | Может нагрузить текущую систему |

## Задание 4

SRE вывел дашборд SLA = 99 % по HTTP-кодам.  
Формула: `SLI = sum(2xx) / sum(все запросы)`  
Значение не выше 70 %, при этом **4xx** и **5xx** отсутствуют.

**Ошибка**  
Не учитываются коды **3xx** (редиректы) и иногда **1xx**. Для большинства сервисов успешными считаются **2xx + 3xx**.

**Правильные формулы**
```text
SLI = (sum(2xx) + sum(3xx)) / sum(все запросы)
