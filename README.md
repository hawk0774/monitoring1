# 13. Системы мониторинга

## Задание 1

Перечислите основные метрики, которые стоит мониторить для оценки состояния приложения и инфраструктуры.

### Мониторинг работоспособности ПО
- Общее количество **HTTP/HTTPS-запросов** к приложению  
- Количество неудачных ответов (коды **4xx** и **5xx**, особенно 400, 404, 500, 503)  
- Доступность приложения из разных георегионов (при необходимости)

### Мониторинг оборудования

| Компонент   | Ключевые метрики                                                                 |
|-------------|-----------------------------------------------------------------------------------|
| **CPU**     | • Общая загрузка процессора<br>• Загрузка CPU от процесса приложения             |
| **RAM**     | • Занятая и свободная память<br>• Динамика потребления                           |
| **HDD/SSD** | • Нагрузка на диск (IOPS, latency)<br>• Остаточная ёмкость<br>• SMART-статус<br>• График заполняемости |
| **Сеть**    | • Объём входящего/исходящего трафика<br>• Ошибки на интерфейсах                  |

### Бизнес-мониторинг (на примере системы формирования отчётов)
- Количество успешно сформированных отчётов  
- Количество неудачных попыток формирования отчётов  
- Количество отчётов в обработке  
- Среднее / 95-й перцентиль времени формирования одного отчёта  

### Мониторинг безопасности
- Аномально высокое количество попыток авторизации  
- Сроки действия SSL/TLS-сертификатов  
- Аномальное количество запросов на отчёты от одного пользователя  
- Трафик из нехарактерных георегионов (если приложение используется только в одной стране)

## Задание 2

Менеджер продукта жалуется, что не понимает **RAM**, **inodes**, **CPU LA** и хочет видеть, насколько команда выполняет обязательства перед клиентами.

**Решение**

1. :
   - **RAM** — сколько оперативной памяти занято и сколько осталось свободно  
   - **inodes** — «ярлыки» на файлы; когда заканчиваются — нельзя создавать новые файлы даже при свободном месте  
   - **CPU Load Average** — средняя загруженность процессора за 1/5/15 минут  


## Задание 3

Бюджет на централизованную систему логов не выделили, но разработчикам нужны ошибки приложений.

**Бюджетные варианты**

| Нагрузка / масштаб      | Решение                                      | Плюсы                     | Минусы                     |
|-------------------------|----------------------------------------------|---------------------------|----------------------------|
| Маленький проект        | grep-скрипты + Slack/Email по ключевым словам | Бесплатно, быстро         | Нет истории и поиска       |
| Средний проект          | **Sentry** (бесплатный лимит 5k событий/мес) или **GlitchTip** | Удобный UI, дедупликация  | При превышении лимита — платно |
| Есть свои сервера       | **Loki + Grafana** или **Graylog CE**        | Бесплатно, масштабируемо  | Нужно администрировать     |
| Уже есть ELK/Zabbix     | Настроить отправку логов в существующий стек | Не требует новых ресурсов | Может нагрузить текущую систему |

## Задание 4

Правильный вариант формулы будет выглядеть так:
SLI = (summ_2xx_requests + summ_3xx_requests + summ_1xx_requests)/(summ_all_requests)

## Задание 5  
**Опишите основные плюсы и минусы pull и push систем мониторинга**

|                          | Push-модель                                                                 | Pull-модель                                                                     |
|--------------------------|-----------------------------------------------------------------------------|---------------------------------------------------------------------------------|
| **Плюсы**                | • Работает за NAT без дополнительных прокси<br>• Меньше нагрузка (можно использовать UDP)<br>• Гибкая настройка на стороне агента (объём, частота, несколько бэкендов)<br>• Легко реализовать репликацию и отказоустойчивость | • Полный контроль источников (только те хосты, что явно добавлены в конфиг)<br>• Легче аутентификация и защита от подделки метрик<br>• Проще отлаживать (можно curl'ом дёрнуть /metrics)<br>• Сервер сам решает, когда забирать данные<br>• Выше безопасность — не нужно открывать входящие порты на коллекторе |
| **Минусы**               | • Сложнее защититься от подделки и флуда<br>• Агенты могут случайно/специально устроить DDoS<br>• При UDP — потеря метрик без гарантии доставки | • Не работает за NAT без прокси или push-шлюза<br>• Больше нагрузка при HTTPS и большом количестве нод<br>• Нужно поддерживать доступность endpoint'ов /metrics |

## Задание 6  
**Какие из перечисленных систем относятся к push-модели, какие к pull, а какие гибридные?**

| Система            | Модель              | Комментарий                                                                 |
|--------------------|---------------------|-----------------------------------------------------------------------------|
| **Prometheus**     | **Pull**            | Основной способ — scraping по HTTP. Push возможен только через Pushgateway (для особых случаев) |
| **TICK-стек**      | **Push**            | Telegraf → InfluxDB, Kapacitor, Chronograf — всё на push-протоколах         |
| **Zabbix**         | **Push** (по умолчанию) | Zabbix agent активно шлёт данные (active checks). Есть также pull-режим через Zabbix proxy/trapper items |
| **VictoriaMetrics**| **Гибрид**          | Полностью поддерживает и Prometheus pull-scraping, и push-протоколы (InfluxDB, Graphite, OpenTSDB, Prometheus remote_write и т.д.) |
| **Nagios**         | **Pull**            | Плагины выполняются на стороне сервера Nagios (NRPE — тоже по сути pull)    |

![alt text](https://raw.githubusercontent.com/hawk0774/monitoring1/main/Screenshot_14.png)
![alt text](https://raw.githubusercontent.com/hawk0774/monitoring1/main/Screenshot_1.png)
![alt text](https://raw.githubusercontent.com/hawk0774/monitoring1/main/Screenshot_3.png)
![alt text](https://raw.githubusercontent.com/hawk0774/monitoring1/main/Screenshot_4.png)
![alt text](https://raw.githubusercontent.com/hawk0774/monitoring1/main/Screenshot_5.png)

